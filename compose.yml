version: "3"
services:
  api:
    image: ghcr.io/randomairborne/pastebot-api
    ports:
      - "8080:8081"
    networks:
      - default
      - ingress_default
    deploy:
      placement:
        constraints:
          - "node.role==manager"
      labels:
        - "traefik.enable=true"
        - "traefik.http.services.pbotapi-service.loadbalancer.server.port=8081"
        - "traefik.http.routers.pbotapi.rule=Host(`api.paste.valk.sh`)"
        - "traefik.http.routers.pbotapi.entrypoints=https"
        - "traefik.http.routers.pbotapi.tls.certresolver=letsencrypt"
  website:
    image: ghcr.io/randomairborne/pastebot-web
    ports:
      - "8080:8082"
    networks:
      - default
      - ingress_default
    deploy:
      placement:
        constraints:
          - "node.role==manager"
      labels:
        - "traefik.enable=true"
        - "traefik.http.services.pbotweb-service.loadbalancer.server.port=8082"
        - "traefik.http.routers.pbotweb.rule=Host(`paste.valk.sh`)"
        - "traefik.http.routers.pbotweb.entrypoints=https"
        - "traefik.http.routers.pbotweb.tls.certresolver=letsencrypt"
  bot:
    image: ghcr.io/randomairborne/pastebot
    deploy:
      labels:
        - "traefik.enable=false"
networks:
  ingress_default:
    external: true
